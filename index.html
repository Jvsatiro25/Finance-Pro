<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Pro | Full View</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f172a; --card-bg: #1e293b; --accent: #22d3ee;
            --success: #10b981; --danger: #ef4444; --text: #f1f5f9;
            --border: #334155;
        }

        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }
        .container { max-width: 1300px; margin: auto; }

        /* Navega√ß√£o */
        .month-scroller { display: flex; gap: 10px; overflow-x: auto; padding: 10px 0; margin-bottom: 20px; scrollbar-width: none; }
        .month-scroller::-webkit-scrollbar { display: none; }
        .month-tab { background: var(--card-bg); border: 1px solid var(--border); padding: 10px 20px; border-radius: 50px; cursor: pointer; white-space: nowrap; color: #94a3b8; font-weight: 600; font-size: 0.85rem; }
        .month-tab.active { background: var(--accent); color: var(--bg); border-color: var(--accent); }

        /* Topo - Visibilidade Total */
        .top-grid { display: grid; grid-template-columns: 1fr 1.5fr 1fr; gap: 15px; margin-bottom: 20px; }
        @media (max-width: 1000px) { .top-grid { grid-template-columns: 1fr; } }

        .header-card { background: linear-gradient(145deg, #1e293b, #0f172a); padding: 20px; border-radius: 16px; border: 1px solid var(--border); }
        .income-group { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        /* Tabelas - Onde o valor era cortado */
        .main-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 900px) { .main-layout { grid-template-columns: 1fr; } }

        .section-card { background: var(--card-bg); border-radius: 16px; padding: 20px; border: 1px solid var(--border); }
        .card-title { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        /* Ajuste de Colunas para ver o valor inteiro */
        .row { display: grid; grid-template-columns: 1.8fr 1.2fr 1.2fr 40px; gap: 8px; margin-bottom: 8px; align-items: center; }
        .column-labels { display: grid; grid-template-columns: 1.8fr 1.2fr 1.2fr 40px; gap: 8px; font-size: 0.65rem; color: #64748b; font-weight: 800; text-transform: uppercase; padding-bottom: 8px; }

        input { 
            background: #0f172a; border: 1px solid var(--border); color: white; 
            padding: 12px 8px; border-radius: 8px; width: 100%; font-size: 0.95rem; /* Fonte maior para leitura */
            min-width: 0; /* Impede que o input estoure o grid */
            outline: none;
        }
        input:focus { border-color: var(--accent); }

        /* Semanas */
        .weeks-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 15px; margin-top: 20px; }
        .week-card { background: var(--card-bg); border-left: 4px solid var(--accent); padding: 20px; border-radius: 12px; border: 1px solid var(--border); border-left-width: 4px; }
        .week-card.over { border-left-color: var(--danger); background: rgba(239, 68, 68, 0.05); }

        .btn-add { background: var(--success); color: white; border: none; width: 35px; height: 35px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-del { color: var(--danger); background: none; border: none; cursor: pointer; font-weight: bold; font-size: 1.2rem; }

        .savings-bar { margin-top: 30px; background: var(--success); color: #064e3b; padding: 25px; border-radius: 16px; text-align: center; font-weight: 800; font-size: 1.4rem; }
        label { font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; font-weight: 700; display: block; margin-bottom: 4px; }
        h2 { margin: 0; word-break: normal; white-space: nowrap; }
    </style>
</head>
<body>

<div class="container">
    <div class="month-scroller" id="month-tabs"></div>

    <div class="top-grid">
        <div class="header-card">
            <label>Estrat√©gia</label>
            <select id="smart-strategy" onchange="calculate()" style="background:#0f172a; color:white; border:1px solid var(--border); padding:10px; border-radius:8px; width:100%;">
                <option value="balanced">Equilibrado (Repartir)</option>
                <option value="reserve">Reserva (Economizar)</option>
            </select>
        </div>

        <div class="header-card">
            <div class="income-group">
                <div><label>Renda Fixa</label><input type="text" id="income" placeholder="R$ 0,00" oninput="formatAndSave(this)"></div>
                <div><label>Renda Extra</label><input type="text" id="income-extra" placeholder="R$ 0,00" oninput="formatAndSave(this)"></div>
            </div>
        </div>

        <div class="header-card" style="border-color: var(--accent); text-align: right;">
            <label>Livre para Semanas</label>
            <h2 id="leftover-val" style="color: var(--accent);">R$ 0,00</h2>
        </div>
    </div>

    <div class="main-layout">
        <div class="section-card">
            <div class="card-title"><h3>üìã Despesas</h3> <button class="btn-add" onclick="addRow('exp-list', '', 'R$ 0,00', 'R$ 0,00', true)">+</button></div>
            <div class="column-labels"><span>Item</span><span>Meta</span><span>Real</span><span></span></div>
            <div id="exp-list"></div>
        </div>

        <div class="section-card">
            <div class="card-title"><h3>üì∫ Assinaturas</h3> <button class="btn-add" onclick="addRow('sub-list', '', 'R$ 0,00', 'R$ 0,00', true)">+</button></div>
            <div class="column-labels"><span>Item</span><span>Meta</span><span>Real</span><span></span></div>
            <div id="sub-list"></div>
        </div>
    </div>

    <h3 style="margin-top: 35px; color: var(--accent);">üóìÔ∏è Planejamento Semanal</h3>
    <div class="weeks-container" id="weeks-grid"></div>

    <div class="savings-bar" id="savings-box">SALDO ESTIMADO: R$ 0,00</div>
</div>

<script>
    const formatter = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
    let currentSelectedMonth = "";
    let db = JSON.parse(localStorage.getItem('finance_pro_autosave')) || {};

    function generateMonthTabs() {
        const tabsContainer = document.getElementById('month-tabs');
        const now = new Date();
        for (let i = -2; i <= 6; i++) {
            const date = new Date(now.getFullYear(), now.getMonth() + i, 1);
            const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            const btn = document.createElement('div');
            btn.className = `month-tab ${i === 0 ? 'active' : ''}`;
            btn.innerText = date.toLocaleDateString('pt-BR', { month: 'short', year: '2-digit' }).toUpperCase();
            btn.onclick = () => selectMonth(monthKey, btn);
            tabsContainer.appendChild(btn);
            if(i === 0) currentSelectedMonth = monthKey;
        }
    }

    function selectMonth(monthKey, element) {
        document.querySelectorAll('.month-tab').forEach(t => t.classList.remove('active'));
        element.classList.add('active');
        currentSelectedMonth = monthKey;
        loadMonthData();
    }

    function parseValue(val) {
        if (!val) return 0;
        return parseFloat(val.replace(/[^\d]/g, "")) / 100;
    }

    function formatAndSave(input) {
        let value = input.value.replace(/\D/g, "");
        input.value = formatter.format(value / 100);
        calculate();
    }

    function addRow(containerId, name="", plan="R$ 0,00", real="R$ 0,00", isManual = false) {
        const container = document.getElementById(containerId);
        const div = document.createElement('div');
        div.className = 'row';
        div.innerHTML = `
            <input type="text" placeholder="Item" value="${name}" oninput="calculate()">
            <input type="text" oninput="formatAndSave(this)" value="${plan}">
            <input type="text" oninput="formatAndSave(this)" value="${real}">
            <button class="btn-del" onclick="this.parentElement.remove(); calculate()">‚úï</button>
        `;
        container.appendChild(div);
        if(isManual) calculate();
    }

    function calculate() {
        const income = document.getElementById('income').value;
        const incomeExtra = document.getElementById('income-extra').value;
        const exp = Array.from(document.querySelectorAll('#exp-list .row')).map(r => ({n: r.children[0].value, p: r.children[1].value, r: r.children[2].value}));
        const sub = Array.from(document.querySelectorAll('#sub-list .row')).map(r => ({n: r.children[0].value, p: r.children[1].value, r: r.children[2].value}));
        const strategy = document.getElementById('smart-strategy').value;
        const weekInputs = document.querySelectorAll('.w-spent');
        const weeksValues = Array.from(weekInputs).map(i => i.value);

        db[currentSelectedMonth] = { income, incomeExtra, exp, sub, weeks: weeksValues, strategy };
        localStorage.setItem('finance_pro_autosave', JSON.stringify(db));

        const totalInc = parseValue(income) + parseValue(incomeExtra);
        let totalFixoReal = 0;
        exp.concat(sub).forEach(item => totalFixoReal += parseValue(item.r));
        const leftover = totalInc - totalFixoReal;
        document.getElementById('leftover-val').innerText = formatter.format(leftover);

        let remBudget = leftover;
        weekInputs.forEach((input, index) => {
            const gasto = parseValue(input.value);
            let meta = strategy === 'balanced' ? remBudget / (weekInputs.length - index) : leftover / weekInputs.length;
            if (meta < 0) meta = 0;
            input.parentElement.querySelector('.w-meta').innerText = formatter.format(meta);
            remBudget -= gasto;
            input.parentElement.parentElement.className = 'week-card' + (gasto > meta + 0.1 ? ' over' : '');
        });
        document.getElementById('savings-box').innerText = "SALDO FINAL ESTIMADO: " + formatter.format(remBudget);
    }

    function loadMonthData() {
        const data = db[currentSelectedMonth];
        document.getElementById('exp-list').innerHTML = '';
        document.getElementById('sub-list').innerHTML = '';

        if (data) {
            document.getElementById('income').value = data.income || 'R$ 0,00';
            document.getElementById('income-extra').value = data.incomeExtra || 'R$ 0,00';
            document.getElementById('smart-strategy').value = data.strategy || 'balanced';
            data.exp.forEach(e => addRow('exp-list', e.n, e.p, e.r));
            data.sub.forEach(s => addRow('sub-list', s.n, s.p, s.r));
            renderWeeks(currentSelectedMonth, data.weeks);
        } else {
            const keys = Object.keys(db).sort();
            const prevKey = keys.filter(k => k < currentSelectedMonth).pop();
            const prevData = db[prevKey];
            if (prevData) {
                document.getElementById('income').value = prevData.income;
                prevData.exp.forEach(e => addRow('exp-list', e.n, e.r, 'R$ 0,00'));
                prevData.sub.forEach(s => addRow('sub-list', s.n, s.r, 'R$ 0,00'));
            }
            renderWeeks(currentSelectedMonth);
        }
        calculate();
    }

    function renderWeeks(monthStr, savedWeeks = []) {
        const [y, m] = monthStr.split('-');
        const lastDay = new Date(y, m, 0).getDate();
        const firstDay = new Date(y, m - 1, 1).getDay();
        const numWeeks = Math.ceil((lastDay + firstDay) / 7);
        const grid = document.getElementById('weeks-grid');
        grid.innerHTML = '';
        for (let i = 0; i < numWeeks; i++) {
            grid.innerHTML += `<div class="week-card"><div><label>Semana ${i+1}</label><h3 class="w-meta" style="margin-bottom:10px">R$ 0,00</h3><label>Gasto Real</label><input type="text" class="w-spent" oninput="formatAndSave(this)" value="${savedWeeks[i] || 'R$ 0,00'}"></div></div>`;
        }
    }

    window.onload = () => { generateMonthTabs(); loadMonthData(); };
</script>
</body>
</html>
